<app-loader *ngIf="loader"></app-loader>

<!-- {{form.value|json}} -->
<div class="inner-container col-lg-12 col-md-12 col-sm-12">

    <div class="wrapper">
        <form [formGroup]="form">
            <div class="row py-2">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="row">
                        <div class="col-9 pl-0 pb-2 d-flex pl-3">
                            <mat-icon class="gray cursorPointer"
                                [routerLink]="['/pitch/campaign/list']">keyboard_backspace</mat-icon>
                            <legend class="pl-2" *ngIf="!path">Add New Campaign</legend>
                            <legend class="pl-2" *ngIf="path">Edit Campaign</legend>
                        </div>
                    </div>
                </div>
                <div class="col-lg-11 col-md-11 col-sm-11">
                    <div class="row" style="display: flex;gap:12px;">
                        <div class="col-lg-5 col-md-5 col-sm-11">
                            <mat-form-field appearance="fill">
                                <mat-label>Campaign Name</mat-label>
                                <input matInput formControlName="CampaignName" />
                                <mat-error *ngIf="form.get('CampaignName')?.errors">
                                    <ng-container *ngIf="form.get('CampaignName')?.errors?.required">
                                        Campaign Name {{ isRequiredMessage }}
                                    </ng-container>
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="col-lg-5 col-md-5 col-sm-11">
                            <mat-form-field appearance="fill">
                                <mat-label>Description</mat-label>
                                <input matInput formControlName="CampaignDesc" />
                                <mat-error *ngIf="form.get('CampaignDesc')?.errors">
                                    <ng-container *ngIf="form.get('CampaignDesc')?.errors?.required">
                                        Description {{ isRequiredMessage }}
                                    </ng-container>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="row mb-3">
                        <div class="col-lg-3 col-md-3 col-sm-12 d-flex mt-2" style="justify-content: space-between;">
                            <span class="selectColor mt-2">Target Audience Type</span>
                        </div>
                        <div class="col-lg-7 col-md-7 col-sm-12 d-flex mt-2">
                            <span class="pt-2" style="font-size:smaller">
                                <mat-radio-group aria-labelledby="example-radio-group-label"
                                    class="d-flex tiles example-radio-group" formControlName="targetAudienceList"
                                    color="primary">
                                    <mat-radio-button value="ImportNew" class="example-radio-button tiles">
                                    </mat-radio-button>
                                    <mat-label class="" style="margin-left:-15px;">Import New</mat-label>

                                    <mat-radio-button value="ExistingNew" class="example-radio-button tiles"
                                        style="margin-left:20px;"></mat-radio-button>
                                    <mat-label class="" style="margin-left:-15px;">Existing Audience</mat-label>

                                    <mat-radio-button value="Polling" class="example-radio-button tiles"
                                        style="margin-left:20px;"></mat-radio-button>
                                    <mat-label class="" style="margin-left:-15px;">Polling</mat-label>

                                    <mat-radio-button value="RealTime" class="example-radio-button tiles"
                                        style="margin-left:20px;"></mat-radio-button>
                                    <mat-label class="" style="margin-left:-15px;">Real Time</mat-label>
                                </mat-radio-group>
                            </span>
                        </div>
                    </div>
                </div>

                <!--Import New-->

                <div class="col-lg-12 col-md-12 col-sm-12" *ngIf="form.value.targetAudienceList == 'ImportNew'">
                    <div class="row">
                        <div class="col-lg-9 col-md-9 col-sm-12 import-container mb-3">
                            <mat-expansion-panel [expanded]="!showThrottling">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="d-flex justify-content-between">
                                        <span class="header-title">Import New</span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="row align-items-center">
                                    <div class="col-7">
                                        <mat-form-field appearance="fill">
                                            <mat-label>Audience List Name</mat-label>
                                            <input matInput formControlName="AudienceListName"
                                                (keypress)="validateKeyPress($event)" #AudienceListName />
                                            <mat-error *ngIf="form.get('AudienceListName')?.errors">
                                                <ng-container *ngIf="form.get('AudienceListName')?.errors?.pattern">
                                                    Audience List Name {{charAndNumOnly}}
                                                </ng-container>
                                                <ng-container *ngIf="form.get('AudienceListName')?.errors?.required">
                                                    Audience List Name {{ isRequiredMessage }}
                                                </ng-container>
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4">
                                        <mat-form-field appearance="fill" class="dropdownButtonField">
                                            <mat-label>Structure List</mat-label>
                                            <mat-select class="skilldrop" formControlName="structureList">
                                                <mat-option *ngFor="let item of structureListArr" [value]="item.Id">
                                                    {{item?.StructureName}}
                                                </mat-option>
                                            </mat-select>
                                            <mat-error *ngIf="form.get('structureList')?.errors">
                                                <ng-container *ngIf="form.get('structureList')?.errors?.required">
                                                    Structure List {{ isRequiredMessage }}
                                                </ng-container>
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-1 mb-4 excel-dow-button" *ngIf="form.get('structureList').value"
                                        style="cursor: pointer;">
                                        <img src="assets/images/downloadSvgIcon.svg" alt="Icon"
                                            (click)="downloadSampleExcel()">
                                    </div>
                                    <!-- <div class="col-1 align-items-center mb-3">
                                        <button mat-raised-button color="primary" type="button"
                                            (click)="checkIfTableExistOrNot()"
                                            [disabled]="(AudienceListName.value.length === 0)">+</button>
                                    </div> -->
                                </div>
                                <!-- <div formArrayName="AudienceListNameArray">
                                    <div *ngFor="let AudienceList of getAudienceListNames().controls; 
                                  let i = index">
                                        <div [formGroupName]="i">
                                            <div class="row align-items-center">
                                                <div class="audienceListField ml-3">
                                                    <div (click)="$event.stopPropagation()">
                                                        <mat-form-field appearance="fill">
                                                            <mat-label>Column Name</mat-label>
                                                            <input matInput formControlName="columnName" />
                                                            <mat-error
                                                                *ngIf="getAudienceListNames()?.controls[i]?.get('columnName')?.errors?.required">
                                                                Column Name is required
                                                            </mat-error>
                                                        </mat-form-field>
                                                    </div>
                                                </div>

                                                <div class="audienceListField ml-2">
                                                    <mat-form-field appearance="fill" class="dropdownButtonField">
                                                        <mat-label>Data Type</mat-label>
                                                        <mat-select class="skilldrop" formControlName="dataType">
                                                            <mat-option *ngFor="let item of dataTypes"
                                                                [value]="item.type">
                                                                {{item?.type}}
                                                            </mat-option>
                                                        </mat-select>
                                                        <mat-error
                                                            *ngIf="getAudienceListNames()?.controls[i]?.get('dataType')?.errors?.required">
                                                            Data Type is required
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>

                                                <div class="audienceListField ml-2">
                                                    <mat-form-field appearance="fill">
                                                        <mat-label>MaxLength</mat-label>
                                                        <input matInput formControlName="maxLength" maxlength="4" />
                                                        <mat-error
                                                            *ngIf="getAudienceListNames()?.controls[i]?.get('maxLength')?.errors?.required">
                                                            maxLength is required
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <div class=" d-flex ml-2">
                                                    <div class="mt-2">
                                                        <mat-label class="mr-1">IsNullable</mat-label>
                                                        <mat-checkbox class="example-margin"
                                                            formControlName="isNullable"
                                                            (change)="getIsNullable($event)">
                                                        </mat-checkbox>
                                                    </div>
                                                    <div class="d-flex col-1 mb-3">
                                                        <div class="d-flex align-items-center">
                                                            <button mat-icon-button type="button" color="primary">
                                                                <mat-icon class="add-icon add-btn-audience"
                                                                    (click)="addAudienceColumn()">add</mat-icon>
                                                            </button>
                                                        </div>
                                                        <div class="align-items-center">
                                                            <button mat-icon-button type="button" color="warn">
                                                                <mat-icon
                                                                    (click)="removeAudienceListName(i)">delete</mat-icon>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="col-1 align-items-center mr-2  mb-1">
                                            <button mat-raised-button color="primary" type="button"
                                                (click)="createAudienceTable()" *ngIf="showBtn"
                                                [disabled]="disabledBtn || getAudienceListNames().invalid">Save</button>
                                        </div>
                                    </div>
                                </div> -->
                                <div class="mb-3 import-list-container">
                                    <div class="">
                                        <div class="row">
                                            <div class="import-list-uploadfile text-center">
                                                <p>
                                                    Drag and Drop Single or <br>
                                                    Multiple Excel Audiance List Files
                                                </p>
                                                <div class="">
                                                    <div class="disabledBtn text-center">
                                                        <span class="mx-2 cursorPointer upload-btn"
                                                            (click)="UploadExcel.click()">
                                                            Browse This Computer
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <input class="input-upload-file" type="file"
                                                (change)="UploadCampaignExcel($event)" #UploadExcel id="UploadExcel" />


                                            <!-- <div class="col-6 mb-4 disabledBtn">
                                                <span class="mx-2 cursorPointer upload-btn"
                                                    (click)="UploadExcel.click()">
                                                    Browse This Computer
                                                </span>
                                                <input class="d-none" type="file"  (change)="UploadCampaignExcel($event)"
                                                    #UploadExcel id="UploadExcel" [disabled]="excelFileUpload.length > 0"
                                                    />
                                            </div>

                                            <div class="col-6 mb-4">
                                                <span class="mx-2 cursorPointer upload-btn"
                                                    (click)="downloadSampleExcel()">
                                                    Download List Template
                                                </span>
                                                <input class="d-none" type="file"
                                                (change)="UploadChatIcon($event, 600, 600)" #UploadChatIconDiv
                                                id="UploadChatIconDiv" />
                                            </div> -->

                                        </div>

                                        <!-- <div>
                                            <div class="col-lg-12 col-md-12 col-sm-12 text-center">
                                                <div class="drag-area mx-5">
                                                    <label id="file-input-label" for="file-input">Drag files here</label>
                                                    <input type="file" id="file-input" #fileInput (change)="UploadCampaignExcel($event)"
                                                        class="upload-file-input" title=" " accept=".xls,.xlsx">
                                                </div>
                                            </div>
                                        </div> -->

                                        <div class="uploaded-file d-flex justify-content-between my-3"
                                            *ngFor="let fileName of excelFileUpload; let i=index;">

                                            <span class="mt-1">
                                                <!-- {{fileName.name}} -->
                                                {{InitialExcelfileName[i]}}
                                            </span>
                                            <div class="mt-1 d-flex">
                                                <!-- <span>
                                                    <mat-icon *ngIf="!fileName.status">check_circle</mat-icon>
                                                    <mat-icon class="green"
                                                        *ngIf="fileName.status">check_circle</mat-icon>
                                                </span> -->
                                                <span class="d-flex">
                                                    <mat-progress-spinner *ngIf="!fileName.status" class="green-spinner"
                                                        color="success" [diameter]="20" [value]="progressValue"
                                                        mode="determinate">
                                                    </mat-progress-spinner>
                                                    <span *ngIf="!fileName.status" class="progress-value">{{
                                                        progressValue }}%</span>
                                                    <mat-icon class="green" *ngIf="fileName.status">
                                                        done_all
                                                    </mat-icon>
                                                </span>
                                                <span>
                                                    <mat-icon *ngIf="fileName.status" class="red pointer"
                                                        color="primary"
                                                        (click)="removeExcelFileUpload(i)">delete</mat-icon>
                                                </span>
                                            </div>
                                        </div>

                                        <!-- <div class="drag-drop-file text-center">
                                            <p>Drag and Drop Single or <br>
                                                Multiple Excel Audience List Files</p>
                                        </div> -->
                                        <!-- <div class="uploaded-file d-flex justify-content-between my-3">
                                            <span class="mt-2">
                                                Maharashtra_Mumbai(321221 Audience)
                                            </span>
                                            <span class="mt-2"><mat-icon>check_circle</mat-icon></span>
                                        </div>
                                        <div class="uploaded-file d-flex justify-content-between my-3">
                                            <span class="mt-2">
                                                Maharashtra_Mumbai(321221 Audience)
                                            </span>
                                            <span class="mt-2"><mat-icon>check_circle</mat-icon></span>
                                        </div> -->

                                    </div>
                                </div>

                                <!-- <div class="btn-group">
                                    <button class="mat-focus-indicator btn mat-flat-button mat-button-base"
                                        mat-stroked-button color="primary" type="button"
                                        (click)="uploadExcelFiles()">Upload</button>
                                </div> -->
                            </mat-expansion-panel>
                        </div>

                        <div class="col-lg-9 col-md-9 col-sm-12 import-container mb-3" *ngIf="showThrottling">
                            <mat-expansion-panel style="padding:0!important;" [expanded]="true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="d-flex justify-content-between">
                                        <span class="header-title">{{form.value.AudienceListName}}</span>
                                        <span class="m-2">
                                            <label class="mr-3">Throttling</label>
                                            <mat-slide-toggle color="primary" class="toggleBtn"
                                                formControlName="isThrottlingEnabled">
                                            </mat-slide-toggle>
                                        </span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>

                                <!-- <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="row">
                                        <div class="col-lg-3 col-md-3 col-sm-6 d-flex p-0 inputText normal-dropdown">
                                            <span class="my-2 mr-2"><b>Send</b></span>
                                            <span>
                                                
                                                <input
                                                    style="width: 80%;padding: 8px 10px;background: #fff;border-radius: 5px;border: 1px solid #efefef;outline:0;"
                                                    placeholder="1000" formControlName="campaignSendLimit" />
                                                
                                            </span>
                                        </div>
                                       
                                        <div class="col-lg-4 col-md-4 col-sm-6 d-flex inputText normal-dropdown">
                                            <span class="m-2" style="white-space: nowrap;"><b>Emails Every</b></span>
                                            <span>
                                              
                                                <input
                                                    style="width:30%;padding: 8px 10px;background: #fff;border-radius: 5px 0 0 5px;border: 1px solid #efefef;border-right:0;outline:0;"
                                                    placeholder="5" formControlName="campaignSendFrequency" />
                                               
                                                <mat-form-field appearance="fill" style="width:50%;margin-left:0px;">
                                                    <mat-select formControlName="campaignSendDuration">
                                                        <mat-option *ngFor="let item of sendEmailDur"
                                                            [value]="item.id">{{item.duration}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </span>
                                        </div>
                                    </div>
                                </div> -->
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="row small-font mb-2">
                                        <div class="col-lg-1 col-md-1 col-sm-12 mt-2">
                                            <!-- <mat-icon>drag_indicator</mat-icon> -->
                                        </div>
                                        <div class="col-lg-1 col-md-1 col-sm-12 mt-2 selectColor small-font">
                                            Order
                                        </div>

                                        <div class="col-lg-4 col-md-4 col-sm-12 mt-2 selectColor small-font">
                                            Audience List
                                        </div>
                                        <div class="col-lg-3 col-md-3 col-sm-12 mt-2 selectColor small-font">
                                            Total Audience
                                        </div>
                                        <div class="col-lg-2 col-md-2 col-sm-12 mt-2 selectColor small-font">
                                            Concurrency%
                                        </div>

                                        <div class="col-lg-1 col-md-1 col-sm-12 mt-2">
                                            <!-- <mat-icon color="primary">delete</mat-icon> -->
                                        </div>
                                    </div>
                                    <div cdkDropList [cdkDropListData]="excelFileUpload"
                                        (cdkDropListDropped)="drop($event)">
                                        <div class="row row-bg small-font drag-cursor py-2 my-3"
                                            *ngFor="let excelRow of excelFileUpload; let p=index " cdkDrag>
                                            <ng-container *ngIf="excelRow.status">
                                                <!-- {{excelRow|json}} -->
                                                <div class="col-lg-1 col-md-1 col-sm-12 mt-2">
                                                    <mat-icon>drag_indicator</mat-icon>
                                                </div>
                                                <div class="col-lg-1 col-md-1 col-sm-12 mt-2 order">
                                                    {{p+1}}
                                                </div>
                                                <div class="col-lg-4 col-md-4 col-sm-12 mt-2 audience-list">
                                                    <!-- {{excelRow.name}} -->
                                                    {{InitialExcelfileName[p]}}
                                                </div>
                                                <div class="col-lg-3 col-md-3 col-sm-12 mt-2 total-audience">
                                                    {{excelRow.data.length}}
                                                </div>
                                                <div class="col-lg-2 col-md-2 col-sm-12 concurrency">
                                                    <input
                                                        style="padding: 8px 10px;background: #fff;border-radius: 5px 0 0 5px;border: 1px solid #efefef;outline:0;"
                                                        type="number" min="10" max="100" placeholder="100" />
                                                </div>

                                                <div class="col-lg-1 col-md-1 col-sm-12 mt-2 text-align-right">
                                                    <mat-icon class="red-color"
                                                        (click)="deleteExcelRow(p)">delete</mat-icon>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </div>
                                    <!-- <div class="row  my-3">
                                        <div class="col-lg-1 col-md-1 col-sm-12 mt-2">
                                            <mat-icon>drag_indicator</mat-icon>
                                        </div>
                                        <div class="col-lg-1 col-md-1 col-sm-12 mt-2 order">
                                            1
                                        </div>

                                        <div class="col-lg-4 col-md-4 col-sm-12 mt-2 audience-list">
                                            Maharashtra_Mumbai-02
                                        </div>
                                        <div class="col-lg-3 col-md-3 col-sm-12 mt-2 total-audience">
                                            1652634
                                        </div>
                                        <div class="col-lg-2 col-md-2 col-sm-12 mt-2 concurrency">
                                            <input  style="padding: 8px 10px;background: #fff;border-radius: 5px 0 0 5px;border: 1px solid #efefef;outline:0;" type="number" min="10" max="100" placeholder="10" />
                                        </div>

                                        <div class="col-lg-1 col-md-1 col-sm-12 mt-2 text-align-right">
                                            <mat-icon class="red-color">delete</mat-icon>
                                        </div>
                                    </div> -->
                                </div>
                            </mat-expansion-panel>
                        </div>

                    </div>
                </div>

                <!--Existing List-->

                <div class="col-lg-12 col-md-12 col-sm-12" *ngIf="form.value.targetAudienceList=='ExistingNew'">
                    <div class="row">

                        <div class="col-lg-9 col-md-9 col-sm-12 import-container mb-3">
                            <mat-expansion-panel [expanded]="true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="d-flex justify-content-between">
                                        <span class="header-title">Existing Audience</span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="row">
                                        <div class="col-lg-11 col-md-11 col-sm-12">
                                            <div (click)="$event.stopPropagation()">
                                                <!-- <mat-form-field appearance="fill" (click)="openAudienceListDialog()">
                                                    <mat-label>Existing Audience List</mat-label>
                                                    <mat-select formControlName="CampaignTemplate">
                                                    </mat-select>
                                                </mat-form-field> -->
                                                <mat-form-field appearance="fill" class="dropdownButtonField">
                                                    <mat-label>Existing Audience List</mat-label>
                                                    <mat-select class="skilldrop" formControlName="CampaignTemplate">
                                                        <mat-option *ngFor="let item of audienceList" [value]="item">
                                                            {{item?.['List Name']}}
                                                        </mat-option>
                                                    </mat-select>
                                                    <!-- <mat-error *ngIf="formControl.CampaignTemplate.errors">
                                                        <ng-container *ngIf="formControl.CampaignTemplate.errors.required">
                                                            Existing Audience List {{ isRequiredMessage }}
                                                        </ng-container>
                                                    </mat-error> -->
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </mat-expansion-panel>
                        </div>

                    </div>
                </div>

                <!--Polling List-->

                <div class="col-lg-12 col-md-12 col-sm-12" *ngIf="form.value.targetAudienceList=='Polling'">
                    <div class="row">

                        <div class="col-lg-9 col-md-9 col-sm-12 import-container mb-3">
                            <mat-expansion-panel [expanded]="true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="d-flex justify-content-between">
                                        <span class="header-title">Polling</span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12 col-sm-12">
                                            <mat-form-field appearance="fill">
                                                <mat-label>URL</mat-label>
                                                <input matInput formControlName="pollingUrl" />
                                                <!-- <mat-error *ngIf="formControl.pollingUrl.errors">
                                                    <ng-container *ngIf="formControl.pollingUrl.errors.required">
                                                        URL {{ isRequiredMessage }}
                                                    </ng-container>
                                                </mat-error> -->
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-12">
                                            <div (click)="$event.stopPropagation()">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Method</mat-label>
                                                    <mat-select formControlName="pollingMethod">
                                                        <mat-option>Webchat</mat-option>
                                                        <mat-option>Whatsapp</mat-option>
                                                    </mat-select>
                                                    <!-- <mat-error *ngIf="formControl.pollingMethod.errors">
                                                        <ng-container *ngIf="formControl.pollingMethod.errors.required">
                                                            Polling Method {{ isRequiredMessage }}
                                                        </ng-container>
                                                    </mat-error> -->
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <!-- <div class="col-lg-4 col-md-4 col-sm-12">
                                            <span>Sync Duration</span>
                                            <input class="form-input border-0 w-100"
                                                value="{{form.value.pollingTimer?.hour ? form.value.pollingTimer?.hour : '00'}}:{{form.value.pollingTimer?.minute ? form.value.pollingTimer?.minute : '00'}}:{{form.value.pollingTimer?.second ? form.value.pollingTimer?.second : '00'}}"
                                                [disabled]="true" />
                                            <mat-icon class="timerIconPosition" 
                                                [matMenuTriggerFor]="menu2">access_time</mat-icon>
                                            <mat-menu #menu2="matMenu" 
                                                class="w-100 px-2  d-flex align-items-center cardMoreFetures"
                                                xPosition="before">
                                                <ngb-timepicker #tp name="timepicker" 
                                                    (click)=" $event.preventDefault();" [(ngModel)]="time"
                                                    formControlName="pollingTimer" [seconds]="true" [hourStep]="1"
                                                    [minuteStep]="1" [secondStep]="1">
                                                </ngb-timepicker>
                                            </mat-menu>
                                        </div>  -->
                                        <div class=" d-flex align-items-center polling-sync">
                                            <span class="mx-2">Sync Duration</span>
                                            <input class="form-input border-0 w-25 ml-2" style="text-align: center;"
                                                value="{{form.value.pollingTimer?.hour ? form.value.pollingTimer?.hour : '00'}}:{{form.value.pollingTimer?.minute ? form.value.pollingTimer?.minute : '00'}}:{{form.value.pollingTimer?.second ? form.value.pollingTimer?.second : '00'}}"
                                                [disabled]="true" />
                                            <mat-icon class="timerIconPosition" style="top:8px"
                                                [matMenuTriggerFor]="menu2">access_time</mat-icon>
                                            <mat-menu #menu2="matMenu"
                                                class="w-100 px-2 d-flex align-items-center cardMoreFetures"
                                                xPosition="before">
                                                <ngb-timepicker #tp name="timepicker"
                                                    (click)=" $event.preventDefault();$event.stopPropagation();"
                                                    [(ngModel)]="time" formControlName="pollingTimer" [seconds]="true"
                                                    [hourStep]="1" [minuteStep]="1" [secondStep]="1">
                                                </ngb-timepicker>
                                            </mat-menu>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 col-md-12 col-sm-12">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Body</mat-label>
                                                <textarea rows="5" formControlName="pollingUrlBody" matInput
                                                    minlength="3" maxlength="50"></textarea>
                                                <!-- <mat-error *ngIf="formControl.pollingUrlBody.errors">
                                                    <ng-container *ngIf="formControl.pollingUrlBody.errors.required">
                                                        Polling URL Body {{ isRequiredMessage }}
                                                    </ng-container>
                                                </mat-error> -->
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-12 col-md-12 col-sm-12">
                                            <div class="d-flex justify-content-between">
                                                <span class="selectColor">Add Headers</span>
                                            </div>
                                        </div>
                                        <div formArrayName="pollingHeaders">
                                            <div *ngFor="let polling of getPollingHeaders().controls; 
                                                    let i = index">

                                                <div [formGroupName]="i" class="d-flex">
                                                    <div class="col-lg-6 col-md-8 col-sm-12">
                                                        <mat-form-field appearance="fill">
                                                            <mat-label>Key</mat-label>
                                                            <input matInput formControlName="pollingHeaderKey" />
                                                            <!-- <mat-error
                                                                *ngIf="getPollingHeaders()?.controls[i]?.get('pollingHeaderKey')?.errors?.required">
                                                                Key {{ isRequiredMessage }}
                                                            </mat-error> -->
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="col-lg-6 col-md-8 col-sm-12">
                                                        <mat-form-field appearance="fill">
                                                            <mat-label>Value</mat-label>
                                                            <input matInput formControlName="pollingHeaderValue" />
                                                            <!-- <mat-error
                                                                *ngIf="getPollingHeaders()?.controls[i]?.get('pollingHeaderValue')?.errors?.required">
                                                                Value {{ isRequiredMessage }}
                                                            </mat-error> -->
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="d-flex col-lg-2 col-md-2 col-sm-12">
                                                        <!-- <mat-icon (click)="addPollingHeaders()">add</mat-icon> -->
                                                        <!-- <mat-icon class="red-color" *ngIf="getPollingHeaders().length > 1"
                                                (click)="removePollingHeaders(i)">delete</mat-icon> -->
                                                        <button mat-icon-button type="button" color="primary">
                                                            <mat-icon (click)="addPollingHeaders()">add</mat-icon>
                                                        </button>
                                                        <button mat-icon-button type="button" color="primary">
                                                            <mat-icon *ngIf="getPollingHeaders().length > 1"
                                                                color="warn"
                                                                (click)="removePollingHeaders(i)">delete</mat-icon>
                                                        </button>
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </mat-expansion-panel>
                        </div>

                    </div>
                </div>

                <!--Real Time List-->

                <div class="col-lg-12 col-md-12 col-sm-12" *ngIf="form.value.targetAudienceList=='RealTime'">
                    <div class="row">

                        <div class="col-lg-9 col-md-9 col-sm-12 import-container mb-3">
                            <mat-expansion-panel [expanded]="true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="d-flex justify-content-between">
                                        <span class="header-title">Real Time</span>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="col-lg-12 col-md-12 col-sm-12">
                                    <div class="row">
                                        <div class="col-lg-9 col-md-8 col-sm-12">
                                            <div (click)="$event.stopPropagation()" class="d-flex urlInput">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Url</mat-label>
                                                    <input matInput formControlName="CampaignName" #userinput />
                                                </mat-form-field>
                                                <!-- <input type="text" placeholder="rajkiranjaiswar.com" #userinput> -->
                                                <button class="mat-focus-indicator btn mat-flat-button mat-button-base"
                                                    mat-stroked-button style="border-radius: 30px;"
                                                    (click)="copyInputMessage(userinput)"> Copy
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-lg-2 col-md-4 col-sm-12">
                                            <div class="realtime-btn">
                                                <!-- <button class="mat-focus-indicator btn mat-flat-button mat-button-base"
                                                    mat-stroked-button color="primary">
                                                    Copy
                                                </button> -->
                                                <button class="mat-focus-indicator btn mat-flat-button mat-button-base"
                                                    mat-stroked-button>
                                                    View
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </mat-expansion-panel>
                        </div>

                    </div>
                </div>
            </div>




            <!-- Rule -->
            <div class="row py-2">
                <div class="col-lg-12 col-md-12 col-sm-12 mt-4">
                    <div class="row">
                        <div class="col-lg-11 col-md-11 col-sm-12">
                            <div class="d-flex justify-content-between">
                                <span class="selectColor">Rule</span>
                                <button type="button" class="btn rule-add-btn " (click)="addRule()">
                                    <span class="d-flex align-items-center justify-content-between">
                                        <mat-icon class="primary-color">add</mat-icon> Add&nbsp;
                                        <span>Rule</span>
                                    </span>
                                </button>
                            </div>
                        </div>

                        <div class="import-container mb-3" formArrayName="rule"
                            *ngFor="let rule of getRule()['controls'];let i = index">
                            <!-- add form here -->
                            <!-- {{form.value.condition[i]|json}} -->
                            <mat-expansion-panel [formGroupName]="i" style="padding:0!important;"
                                [expanded]="rule.lenght > 1 ? false : true ">

                                <mat-expansion-panel-header>
                                    <mat-panel-title class="d-flex justify-content-between">
                                        <span class="header-title">{{!form?.value?.rule[i]?.ruleName ? ('Rule ' + (i+1))
                                            : form?.value?.rule[i]?.ruleName}}</span>

                                        <mat-icon class="red pointer mt-2" (click)="removeRule(i)"
                                            *ngIf="getRule().length > 1" color="warn">delete</mat-icon>

                                    </mat-panel-title>
                                </mat-expansion-panel-header>

                                <div class="">
                                    <div class="row">
                                        <!--*ngFor="let rule of campaignForm.get('rules')['controls']; let i = index"-->
                                        <!--[formControlName]="i"-->
                                        <div class="col-lg-8">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Rule Name</mat-label>
                                                <input matInput formControlName="ruleName"
                                                    [ngModel]="'Rule ' + (i+1)" />
                                                <mat-error *ngIf="getRule()?.controls[i]?.get('ruleName')?.errors">
                                                    <ng-container
                                                        *ngIf="getRule()?.controls[i]?.get('ruleName')?.errors?.required">
                                                        Rule Name {{ isRequiredMessage }}
                                                    </ng-container>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>

                                        <div class="col-lg-4 addChannel">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Add Channel</mat-label>
                                                <mat-select #closeChannel matInput formControlName="addChannel"
                                                    class="white_bg" multiple (selectionChange)="updateRuleChannels(i)">
                                                    <!-- (selectionChange)="removeUncheckChannels($event,i)" -->
                                                    <ng-container *ngFor="let data of Channel">
                                                        <mat-option
                                                            *ngIf="data.ChannelId === 1 || data.ChannelId === 34 || data.ChannelId === 28"
                                                            [value]="data.ChannelId" style="padding:0 5px;">
                                                            <!-- (click)="getChannelIdAndEvent($event, data.ChannelId)" -->
                                                            <span [innerHtml]="data?.ChannelIcon"
                                                                style="vertical-align:sub;"></span>
                                                            <span>{{data.ChannelName}}</span>
                                                        </mat-option>
                                                    </ng-container>
                                                    <!-- <button (click)="addRuleChannels(i); closeChannel.close()"
                                                        class="add-channel">Add Channel</button> -->
                                                </mat-select>
                                                <mat-error *ngIf="getRule()?.controls[i]?.get('addChannel')?.errors">
                                                    <ng-container
                                                        *ngIf="getRule()?.controls[i]?.get('addChannel')?.errors?.required">
                                                        Channel {{ isRequiredMessage }}
                                                    </ng-container>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>




                                        <div class="col-12" formArrayName="RuleChannels"
                                            *ngFor="let item of getRuleChannels(i)['controls'];let j = index">
                                            <div class="border-separater mb-4" *ngIf="item"></div>
                                            <!-- {{item.value | json}} -->
                                            <div class="row" [formGroupName]="j">
                                                <div class="col-lg-4 col-md-4 col-sm-12">
                                                    <div class="channelWithIcon">
                                                        <div class="inner">
                                                            <div><small>Channel</small></div>
                                                            <div class="channelWithIconInner">
                                                                <span
                                                                    [innerHTML]="getChannelIcon(item?.value?.channel)"></span>
                                                                <span>{{getChannelName(item?.value?.channel)}}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- <mat-form-field appearance="fill">
                                                        <mat-label>Channel</mat-label>
                                                        <input matInput readonly
                                                            value="{{getChannelName(item?.value?.channel)}}" />
                                                    </mat-form-field> -->
                                                </div>
                                                <br>
                                                <div class="col-lg-4 col-md-4 col-sm-12">
                                                    <mat-form-field appearance="fill">
                                                        <mat-label>Channel Source</mat-label>
                                                        <mat-select matInput formControlName="channelSource"
                                                            (selectionChange)="getTemplate($event,i,j,item.value.channel)">
                                                            <mat-option
                                                                *ngFor="let data of ChannelSource[item?.value?.channel]"
                                                                [value]="data.ChannelSourceId">{{data.ChannelSourceName}}</mat-option>
                                                        </mat-select>
                                                        <mat-error
                                                            *ngIf="getRuleChannels(i).controls[j].get('channelSource')?.errors">
                                                            <ng-container
                                                                *ngIf="getRuleChannels(i).controls[j].get('channelSource')?.errors?.required">
                                                                Channel Source {{ isRequiredMessage }}
                                                            </ng-container>
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>

                                                <div class="col-lg-4 col-md-4 col-sm-12">
                                                    <div (click)="$event.stopPropagation()">
                                                        <mat-form-field appearance="fill">
                                                            <mat-label>Language</mat-label>
                                                            <mat-select formControlName="languageSelected"
                                                                (selectionChange)="selectLan($event.value,i,j)"
                                                                multiple>
                                                                <mat-option *ngFor="let data of language"
                                                                    [value]="data.LanguageCode">
                                                                    {{data.Language}}
                                                                </mat-option>
                                                            </mat-select>
                                                            <mat-error
                                                                *ngIf="getRuleChannels(i).controls[j].get('languageSelected')?.errors">
                                                                <ng-container
                                                                    *ngIf="getRuleChannels(i).controls[j].get('languageSelected')?.errors?.required">
                                                                    Language {{ isRequiredMessage }}
                                                                </ng-container>
                                                            </mat-error>
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                                <!-- {{ item.value.languageSelected | json}} -->
                                                <!-- {{item.value.hsmSelected|keyvalue | json}} -->
                                                <div class="col-12">
                                                    <div class="mb-2">
                                                        <div class="tabs" formGroupName="hsmSelected"
                                                            *ngIf="item.value?.languageSelected !== '' ">
                                                            <!-- {{ item.value.languageSelected | json}}
                                                             {{item.value.hsmSelected|keyvalue | json}} -->
                                                            <div class="">
                                                                <div class=" tabs-list p-0" mat-tab-nav-bar>
                                                                    <!-- {{i|json}}
                                                                    {{j|json}} -->
                                                                    <!-- <a mat-tab-link *ngFor="let data of let item2 of ObjectKeys(item.value.hsmSelected)" -->
                                                                    <a mat-tab-link
                                                                        *ngFor="let data of ObjectKeys(item.value.hsmSelected)"
                                                                        (click)="onTabChange(data);languageSelectedForRule[i][j] = data"
                                                                        [active]="languageSelectedForRule[i][j] == data"
                                                                        class="usernavTab">
                                                                        {{ getFullLanguageName(data) }}
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="" *ngIf="languageSelectedForRule[i][j]" -->
                                                            <div class=""
                                                                *ngIf="languageSelectedForRule[i] && languageSelectedForRule[i][j]"
                                                                [formGroupName]="languageSelectedForRule[i][j]">
                                                                <div class="col-lg-12 template-Container p-3">
                                                                    <!-- {{languageSelectedForRule[i][j] | json}} -->
                                                                    <span>Field Mapping</span>
                                                                    <div class="row p-3">
                                                                        <div class="col-lg-3 templateThubnail"
                                                                            (click)="callDialog(i,j,item.value.channel,item.value.channelSource,languageSelectedForRule[i][j])">
                                                                            <div class="align-center FieldMappingImage">
                                                                                <mat-icon
                                                                                    *ngIf="!HSMvalues?.[item.value.channel]?.[item.value.channelSource]?.[languageSelectedForRule[i][j]]?.[item?.value?.hsmSelected[languageSelectedForRule[i][j]]?.selectedHSM]?.['Message Header Value']">
                                                                                    upload</mat-icon>
                                                                                <!-- {{HSMvalues?.[item.value.channel]?.[item.value.channelSource]?.[languageSelectedForRule[i][j]]?.[item?.value?.hsmSelected[languageSelectedForRule[i][j]]?.selectedHSM]?.['Message Header Value']|json}} -->
                                                                                <img [src]="HSMvalues?.[item.value.channel]?.[item.value.channelSource]?.[languageSelectedForRule[i][j]]?.[item?.value?.hsmSelected[languageSelectedForRule[i][j]]?.selectedHSM]?.['Message Header Value']"
                                                                                    alt="">
                                                                                <!-- src="{{returnSRC(item.value.channel,item.value.channelSource,166)}}" -->
                                                                                <!-- src={{returnSRC(actionVar.value.channel,actionVar.value.channelSource,item3.value)}} -->
                                                                            </div>
                                                                            <div class="align-center">
                                                                                {{getFullLanguageName(languageSelectedForRule[i][j])
                                                                                }} Template
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-lg-9 pr-0"
                                                                            formArrayName="fieldMapping">
                                                                            <div class="row mb-2"
                                                                                *ngIf="getFieldMappingFormArray(i,j).length > 0">
                                                                                <div class="col-5">Campaign Field</div>
                                                                                <div class="col-5">Audience List Field
                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                *ngFor="let item123 of getFieldMappingFormArray(i,j)['controls']; let jj = index; let firstfirst = first">
                                                                                <div class="row" [formGroupName]="jj">
                                                                                    <div class="col-lg-5">
                                                                                        <!-- <span>Campaign Field</span> -->
                                                                                        <!-- <div (click)="$event.stopPropagation()"> -->
                                                                                        <mat-form-field
                                                                                            appearance="fill">
                                                                                            <mat-label>HSM
                                                                                                Field</mat-label>
                                                                                            <input matInput
                                                                                                formControlName="key"
                                                                                                readonly>
                                                                                        </mat-form-field>
                                                                                        <!-- </div> -->
                                                                                    </div>
                                                                                    <div class="col-lg-5">
                                                                                        <!-- <span>Audience List Field</span> -->
                                                                                        <!-- <div (click)="$event.stopPropagation()"> -->
                                                                                        <mat-form-field
                                                                                            (click)="isColumnValueEmpty()"
                                                                                            appearance="fill">
                                                                                            <mat-label>Select
                                                                                                Field</mat-label>
                                                                                            <mat-select
                                                                                                formControlName="value">
                                                                                                <mat-option
                                                                                                    *ngFor="let column of columnValue | keyvalue"
                                                                                                    [value]="column.key">{{column.key}}
                                                                                                </mat-option>
                                                                                            </mat-select>
                                                                                            <mat-error
                                                                                                *ngIf="getFieldMappingFormArray(i, j)?.controls[jj]?.get('value')?.errors">
                                                                                                <!-- <ng-container
                                                                                                    *ngIf="getFieldMappingFormArray(i, j)?.controls[jj]?.get('value')?.errors?.required">
                                                                                                    Audience List Field
                                                                                                    {{ isRequiredMessage
                                                                                                    }}
                                                                                                </ng-container> -->
                                                                                                <ng-container
                                                                                                    *ngIf="getFieldMappingFormArray(i, j)?.controls[jj]?.get('value')?.hasError('required') &&
                                                                                                getFieldMappingFormArray(i, j)?.controls[jj]?.get('value')?.touched">
                                                                                                    Audience List Field
                                                                                                    is empty!
                                                                                                </ng-container>
                                                                                            </mat-error>
                                                                                            <!-- <mat-error *ngIf="getFieldMappingFormArray(i, j)?.controls[jj]?.get('value')?.hasError('required') &&
                                                                                                getFieldMappingFormArray(i, j)?.controls[jj]?.get('value')?.touched">Audience List Field is empty!</mat-error> -->
                                                                                            <!-- <mat-error *ngIf="isColumnValueEmpty()">ColumnValue is empty!</mat-error> -->
                                                                                        </mat-form-field>
                                                                                        <!-- </div> -->
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>


                                        <div class="border-separater"></div>


                                        <!-- data filter -->
                                        <br>

                                        <div class="col-lg-12 col-md-12 col-sm-12">
                                            <div class="row">

                                                <div class="col-lg-12 col-md-12 col-sm-12">
                                                    <mat-panel-title class="d-flex ">
                                                        <span class="header-title">Data Filter</span> &nbsp;
                                                        &nbsp;
                                                        <!-- <span class="filter-btn"><mat-slide-toggle class="slideToggle"></mat-slide-toggle> </span> -->
                                                        <span class="filter-btn">
                                                            <mat-slide-toggle color="primary"
                                                                formControlName="isDataFilterEnable" class="toggleBtn">
                                                            </mat-slide-toggle>
                                                        </span>
                                                    </mat-panel-title>
                                                    <br>
                                                    <div class="" *ngIf="form?.value?.rule[i]?.isDataFilterEnable">
                                                        <div class="row ">
                                                            <div class="col-lg-9 col-md-9 col-sm-12 d-flex">
                                                                <mat-form-field appearance="fill">
                                                                    <mat-label>Condtion Name</mat-label>
                                                                    <input formControlName="conditionName" type="text"
                                                                        matInput />
                                                                    <mat-error
                                                                        *ngIf="getRule()?.controls[i]?.get('conditionName')?.errors ">
                                                                        <ng-container
                                                                            *ngIf="getRule()?.controls[i]?.get('conditionName')?.errors?.required">
                                                                            Condition Name {{ isRequiredMessage }}
                                                                        </ng-container>
                                                                    </mat-error>
                                                                </mat-form-field>
                                                            </div>
                                                        </div>
                                                        <div
                                                            style="display: flex; flex-direction:row-reverse; cursor:pointer;">
                                                            <mat-icon (click)="addDataFilter(i)"
                                                                class="add-icon add-btn"
                                                                style="position: relative; top: 33px;left: 25px;z-index:9999;">add</mat-icon>
                                                        </div>
                                                        <!-- {{getDataFilter(i)?.controls[i]?.get('field')?.errors?.required}} -->

                                                        <div class="row d-flex">
                                                            <div class="col-lg-12 col-md-12 col-sm-12"
                                                                formArrayName="dataFilter">
                                                                <div class="row d-flex"
                                                                    *ngFor="let data of getDataFilter(i)['controls']; let k = index;">
                                                                    <div class="d-flex" [formGroupName]="k">
                                                                        <div class="col-lg-3 col-md-3 col-sm-12">
                                                                            <mat-form-field appearance="fill"
                                                                                (click)="isColumnValueEmpty()">
                                                                                <mat-label>Field</mat-label>
                                                                                <mat-select class="skilldrop"
                                                                                    formControlName="field">
                                                                                    <mat-option
                                                                                        *ngFor="let column of columnValue | keyvalue"
                                                                                        [value]="column.key">{{column.key}}</mat-option>
                                                                                </mat-select>
                                                                                <mat-error
                                                                                    *ngIf="getDataFilter(i)?.controls[k]?.get('field')?.errors">
                                                                                    <ng-container
                                                                                        *ngIf="getDataFilter(i)?.controls[k]?.get('field')?.errors?.required">
                                                                                        Field {{ isRequiredMessage }}
                                                                                    </ng-container>
                                                                                </mat-error>
                                                                            </mat-form-field>
                                                                        </div>

                                                                        <div class="col-lg-3 col-md-3 col-sm-12">
                                                                            <mat-form-field appearance="fill">
                                                                                <mat-label>Condition</mat-label>
                                                                                <mat-select formControlName="condition">
                                                                                    <mat-option
                                                                                        *ngFor="let k of Conditonsdata[0]|keyvalue"
                                                                                        [value]="k.key">{{k.key}}</mat-option>
                                                                                </mat-select>
                                                                                <mat-error
                                                                                    *ngIf="getDataFilter(i)?.controls[k]?.get('condition')?.errors">
                                                                                    <ng-container
                                                                                        *ngIf="getDataFilter(i)?.controls[k]?.get('condition')?.errors?.required">
                                                                                        Condition {{ isRequiredMessage
                                                                                        }}
                                                                                    </ng-container>
                                                                                </mat-error>
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="col-lg-3 col-md-3 col-sm-12">
                                                                            <mat-form-field appearance="fill">
                                                                                <mat-label>Value</mat-label>
                                                                                <input formControlName="dataFiltervalue"
                                                                                    type="text" matInput />
                                                                                <mat-error
                                                                                    *ngIf="getDataFilter(i)?.controls[k]?.get('dataFiltervalue')?.errors">
                                                                                    <ng-container
                                                                                        *ngIf="getDataFilter(i)?.controls[k]?.get('dataFiltervalue')?.errors?.required">
                                                                                        Value {{ isRequiredMessage }}
                                                                                    </ng-container>
                                                                                </mat-error>
                                                                            </mat-form-field>
                                                                        </div>

                                                                        <div class="col-lg-3 col-md-3 col-sm-12">
                                                                            <!-- {{item.value.getAndOrCondition|json}} -->
                                                                            <mat-button-toggle-group class="andorbtn"
                                                                                name="favoriteColor"
                                                                                aria-label="Favorite Color"
                                                                                formControlName="getAndOrDataFilter"
                                                                                (change)="getAndOrDataFilter($event.value)"
                                                                                style="margin-left:-10px;">
                                                                                <mat-button-toggle class="AND-OR-Btn"
                                                                                    [ngClass]="data.value.getAndOrDataFilter == 'AND' ? 'Dark-btn' : ' '"
                                                                                    value="AND">AND</mat-button-toggle>
                                                                                <mat-button-toggle class="AND-OR-Btn"
                                                                                    [ngClass]="data.value.getAndOrDataFilter == 'OR' ? 'Dark-btn' : ' '"
                                                                                    value="OR">OR</mat-button-toggle>
                                                                            </mat-button-toggle-group>

                                                                            <button mat-icon-button type="button"
                                                                                color="primary">
                                                                                <mat-icon
                                                                                    *ngIf="getDataFilter(i).length > 1"
                                                                                    color="warn"
                                                                                    (click)="removeDataFilter(i,k)">delete</mat-icon>
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>


                                                </div>

                                            </div>
                                        </div>
                                        <!-- End Data Filter -->
                                        <!--Condition End-->
                                    </div>
                                    <!-- /Rule UI End-->
                                </div>
                            </mat-expansion-panel>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Rule UI End-->


            <div class="row py-2">
                <!--Campaign Header Section-->
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="row">
                        <div class="col-lg-12 my-2">
                            <div class="d-flex justify-content-between">
                                <span class="selectColor">Schedule</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-2 col-md-3 col-sm-12 headerField">
                            <div (click)="$event.stopPropagation()">
                                <mat-form-field appearance="fill">
                                    <mat-label>Type</mat-label>
                                    <mat-select formControlName="campaignTypeSelected" [(ngModel)]="selectedTypeOption"
                                        (ngModelChange)="onSelectedTypeOptionChange()">
                                        <mat-option *ngFor="let item of campaignType"
                                            [value]="item.Id">{{item.Value}}</mat-option>
                                        <!-- <mat-option>Send Now</mat-option> -->
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-3 col-sm-12 headerField" *ngIf="selectedTypeOption !== 3">
                            <mat-form-field appearance="fill">
                                <mat-label>Start Date</mat-label>
                                <input readonly formControlName="CampaignStartDate" type="text"
                                    [disabled]="form.value.CampaignStartDate < defaultDate"
                                    [matDatepicker]="CampaignStartDate" matInput [ngModel]="defaultDate"
                                    [min]="defaultDate">
                                <mat-datepicker-toggle matSuffix [for]="CampaignStartDate"></mat-datepicker-toggle>
                                <mat-datepicker #CampaignStartDate></mat-datepicker>
                            </mat-form-field>
                            <mat-error *ngIf="form.get('CampaignStartDate').hasError('startDateError')">
                                End duration cannot be less than start duration.
                            </mat-error>
                        </div>

                        <!-- <div>{{form.value.CampaignStartDate | json}}
                        <br>
                        {{defaultDate | json}}</div> -->

                        <div class="col-lg-3 col-md-3 col-sm-3 headerField" *ngIf="selectedTypeOption !== 3">
                            <mat-form-field appearance="fill">
                                <mat-label>Start Duration</mat-label>
                                <input matInput class="form-input border-0" [matMenuTriggerFor]="menu3"
                                    value="{{form.value.HeaderStartTime?.hour ? form.value.HeaderStartTime?.hour > 9 ? form.value.HeaderStartTime?.hour : '0'+ form.value.HeaderStartTime?.hour : '00'}}:{{form.value.HeaderStartTime?.minute ? form.value.HeaderStartTime?.minute > 9 ? form.value.HeaderStartTime?.minute : '0'+ form.value.HeaderStartTime?.minute : '00'}}:{{form.value.HeaderStartTime?.second ? form.value.HeaderStartTime?.second > 9 ? form.value.HeaderStartTime?.second : '0'+ form.value.HeaderStartTime?.second : '00'}}"
                                    style="width:85%;" />
                                <!-- value="{{form.value.HeaderStartTime?.hour ? form.value.HeaderStartTime?.hour > 9 ? form.value.HeaderStartTime?.hour : '0'+ form.value.HeaderStartTime?.hour : '00'}}:{{form.value.HeaderStartTime?.minute ? form.value.HeaderStartTime?.minute > 9 ? form.value.HeaderStartTime?.minute : '0'+ form.value.HeaderStartTime?.minute : '00'}}:{{form.value.HeaderStartTime?.second ? form.value.HeaderStartTime?.second > 9 ? form.value.HeaderStartTime?.second : '0'+ form.value.HeaderStartTime?.second : '00'}}" -->
                                <mat-icon class="timerIconPosition" [matMenuTriggerFor]="menu3"
                                    style="margin-top:-20px;">access_time</mat-icon>
                                <mat-menu #menu3="matMenu" class="w-100 px-2 d-flex align-items-center cardMoreFetures"
                                    xPosition="before">
                                    <ngb-timepicker #tp name="timepicker" (click)=" $event.preventDefault();
                                  $event.stopPropagation();" formControlName="HeaderStartTime" [seconds]="true"
                                        [hourStep]="1" [minuteStep]="1" [secondStep]="1">
                                    </ngb-timepicker>
                                </mat-menu>
                            </mat-form-field>
                        </div>

                        <div class="col-lg-2 col-md-3 col-sm-12 headerField" *ngIf="selectedTypeOption == 2">
                            <mat-form-field appearance="fill">
                                <mat-label>End Date</mat-label>
                                <input readonly formControlName="CampaignEndDate" type="text"
                                    [matDatepicker]="CampaignEndDate" matInput
                                    [ngModel]="path ? (form.get('CampaignEndDate').value || defaultDate) : (form.get('CampaignStartDate').value || defaultDate)"
                                    [min]="form.get('CampaignStartDate').value">
                                <mat-datepicker-toggle matSuffix [for]="CampaignEndDate"></mat-datepicker-toggle>
                                <mat-datepicker #CampaignEndDate></mat-datepicker>
                            </mat-form-field>
                        </div>

                        <div class="col-lg-3 col-md-3 col-sm-3 headerField" *ngIf="selectedTypeOption == 2">
                            <mat-form-field appearance="fill">
                                <mat-label>End Duration</mat-label>
                                <input matInput class="form-input border-0" [matMenuTriggerFor]="menu4"
                                    value="{{form.value.HeaderEndTime?.hour ? form.value.HeaderEndTime?.hour > 9 ? form.value.HeaderEndTime?.hour : '0'+ form.value.HeaderEndTime?.hour : '00'}}:{{form.value.HeaderEndTime?.minute ? form.value.HeaderEndTime?.minute > 9 ? form.value.HeaderEndTime?.minute : '0'+ form.value.HeaderEndTime?.minute : '00'}}:{{form.value.HeaderEndTime?.second ? form.value.HeaderEndTime?.second > 9 ? form.value.HeaderEndTime?.second : '0'+ form.value.HeaderEndTime?.second : '00'}}"
                                    style="width:85%;" />
                                <!-- value="{{form.value.HeaderEndTime?.hour ? form.value.HeaderEndTime?.hour > 9 ? form.value.HeaderEndTime?.hour : '0'+ form.value.HeaderEndTime?.hour : '00'}}:{{form.value.HeaderEndTime?.minute ? form.value.HeaderEndTime?.minute > 9 ? form.value.HeaderEndTime?.minute : '0'+ form.value.HeaderEndTime?.minute : '00'}}:{{form.value.HeaderEndTime?.second ? form.value.HeaderEndTime?.second > 9 ? form.value.HeaderEndTime?.second : '0'+ form.value.HeaderEndTime?.second : '00'}}" -->
                                <mat-icon class="timerIconPosition" [matMenuTriggerFor]="menu4"
                                    style="margin-top:-20px;">access_time</mat-icon>
                                <mat-menu #menu4="matMenu" class="w-100 px-2 d-flex align-items-center cardMoreFetures"
                                    xPosition="before">
                                    <ngb-timepicker #tp name="timepicker" (click)=" $event.preventDefault();
                                     $event.stopPropagation();" formControlName="HeaderEndTime" [seconds]="true"
                                        [hourStep]="1" [minuteStep]="1" [secondStep]="1">
                                    </ngb-timepicker>
                                </mat-menu>
                            </mat-form-field>
                            <mat-error *ngIf="endBeforeStartError">
                                End duration cannot be less than start duration.
                            </mat-error>
                        </div>

                        <!-- ------ -->
                        <!-- One Time -->
                        <div class="col-lg-2 col-md-3 col-sm-12 headerField" *ngIf="selectedTypeOption == 3">
                            <mat-form-field appearance="fill">
                                <mat-label>Start Date</mat-label>
                                <input readonly formControlName="CampaignStartDate" type="text"
                                    [matDatepicker]="CampaignStartDate" matInput [ngModel]="defaultDate"
                                    [disabled]="true">
                                <mat-datepicker-toggle matSuffix [for]="CampaignStartDate"></mat-datepicker-toggle>
                                <mat-datepicker #CampaignStartDate></mat-datepicker>
                            </mat-form-field>
                        </div>

                        <div class="col-lg-3 col-md-3 col-sm-3 headerField" *ngIf="selectedTypeOption == 3">
                            <mat-form-field appearance="fill">
                                <mat-label>Start Duration</mat-label>
                                <input matInput class="form-input border-0" [matMenuTriggerFor]="menu3"
                                    value="{{form.value.HeaderStartTime?.hour ? form.value.HeaderStartTime?.hour > 9 ? form.value.HeaderStartTime?.hour : '0'+ form.value.HeaderStartTime?.hour : '00'}}:{{form.value.HeaderStartTime?.minute ? form.value.HeaderStartTime?.minute > 9 ? form.value.HeaderStartTime?.minute : '0'+ form.value.HeaderStartTime?.minute : '00'}}:{{form.value.HeaderStartTime?.second ? form.value.HeaderStartTime?.second > 9 ? form.value.HeaderStartTime?.second : '0'+ form.value.HeaderStartTime?.second : '00'}}"
                                    style="width:85%;" [disabled]="true" />
                                <!-- value="{{form.value.HeaderStartTime?.hour ? form.value.HeaderStartTime?.hour > 9 ? form.value.HeaderStartTime?.hour : '0'+ form.value.HeaderStartTime?.hour : '00'}}:{{form.value.HeaderStartTime?.minute ? form.value.HeaderStartTime?.minute > 9 ? form.value.HeaderStartTime?.minute : '0'+ form.value.HeaderStartTime?.minute : '00'}}:{{form.value.HeaderStartTime?.second ? form.value.HeaderStartTime?.second > 9 ? form.value.HeaderStartTime?.second : '0'+ form.value.HeaderStartTime?.second : '00'}}" -->
                                <mat-icon class="timerIconPosition" [matMenuTriggerFor]="menu3"
                                    style="margin-top:-20px;">access_time</mat-icon>
                                <mat-menu #menu3="matMenu" class="w-100 px-2 d-flex align-items-center cardMoreFetures"
                                    xPosition="before">
                                    <ngb-timepicker #tp name="timepicker" (click)=" $event.preventDefault();
                                  $event.stopPropagation();" formControlName="HeaderStartTime" [seconds]="true"
                                        [hourStep]="1" [minuteStep]="1" [secondStep]="1">
                                    </ngb-timepicker>
                                </mat-menu>
                            </mat-form-field>
                        </div>

                    </div>
                </div>

                <!-- Button Group -->
                <div class="btn-group mx-3 my-2 mb-4">
                    <button id="reset" #reset class="btn btn-gray" mat-flat-button type="Reset"
                        (click)="resetfunc()">Reset</button>
                    <button class="mat-focus-indicator btn mat-flat-button mat-button-base" mat-stroked-button
                        (click)="addCampaign('insert')" *ngIf="!path" [disabled]="!form.valid">
                        Save
                    </button>
                    <button class="mat-focus-indicator btn mat-flat-button mat-button-base" mat-stroked-button
                        *ngIf="path" [routerLink]="['/pitch/campaign/list']">
                        Cancel
                    </button>
                    <button class="mat-focus-indicator btn mat-flat-button mat-button-base" mat-stroked-button
                        (click)="updateCampaign('update')" *ngIf="path" [disabled]="!form.valid">
                        Update
                    </button>
                    <!-- <button class="mat-focus-indicator btn mat-flat-button mat-button-base mat-primary"
                        mat-stroked-button color="primary">
                        Send for Approval
                    </button> -->
                </div>
            </div>
            <!-- </div> -->

        </form>
    </div>

</div>